"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8853],{77495:function(Pe,V,a){a.r(V),a.d(V,{default:function(){return Mt}});var e=a(32735),T=a(53038),l=a(43383),R=a(90201),A=a(88369),te=a(94638),J=a(96709),j=a(27649),Z=a(82055),O=a(41415),H=a(99223),U=a(17e3),Y=a(56755),F=a(33827),I=a(94547),M=a(19786),h=a(49372),De=a(3685),be=a(19406),L=a(67879),K=a(20108),G=a(59677);const Le=async(t,n)=>{try{const{get:s}=(0,l.tg)(),{data:r}=await s((0,G.Gc)("roles"));return n("The roles have loaded successfully"),r}catch{throw t({type:"warning",message:{id:"notification.error"}}),new Error("error")}},Se=async(t,n)=>{try{const{del:s}=(0,l.tg)();await s(`${(0,G.Gc)("roles")}/${t}`)}catch{n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var Ze=a(60216),f=a.n(Ze),Me=a(35658),v=a(87933),se=a(50563),Oe=a(68625),Ue=a(4038);const q=({sortedRoles:t,canDelete:n,permissions:s,setRoleToDelete:r,onDelete:d})=>{const{formatMessage:o}=(0,L.Z)(),{push:u}=(0,T.k6)(),[g,m]=d,i=c=>n&&!["public","authenticated"].includes(c.type),p=c=>{r(c),m(!g)},E=c=>{u(`/settings/${R.Z}/roles/${c}`)};return e.createElement(Me.p,null,t?.map(c=>e.createElement(I.Tr,{key:c.name,...(0,l.X7)({fn:()=>E(c.id)})},e.createElement(M.Td,{width:"20%"},e.createElement(h.Z,null,c.name)),e.createElement(M.Td,{width:"50%"},e.createElement(h.Z,null,c.description)),e.createElement(M.Td,{width:"30%"},e.createElement(h.Z,null,`${c.nb_users} ${o({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(M.Td,null,e.createElement(v.k,{justifyContent:"end",...l.UW},e.createElement(l.jW,{permissions:s.updateRole},e.createElement(se.h,{onClick:()=>E(c.id),noBorder:!0,icon:e.createElement(Oe.Z,null),label:o({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${c.name}`})})),i(c)&&e.createElement(l.jW,{permissions:s.deleteRole},e.createElement(se.h,{onClick:()=>p(c.id),noBorder:!0,icon:e.createElement(Ue.Z,null),label:o({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${c.name}`})})))))))};var xe=q;q.defaultProps={canDelete:!1},q.propTypes={onDelete:f().array.isRequired,permissions:f().object.isRequired,setRoleToDelete:f().func.isRequired,sortedRoles:f().array.isRequired,canDelete:f().bool};var ke=()=>{const{trackUsage:t}=(0,l.rS)(),{formatMessage:n,locale:s}=(0,L.Z)(),{push:r}=(0,T.k6)(),d=(0,l.lm)(),{notifyStatus:o}=(0,te.G)(),[{query:u}]=(0,l.Kx)(),g=u?._q||"",[m,i]=(0,e.useState)(!1),[p,E]=(0,e.useState)(!1),[c,C]=(0,e.useState)();(0,l.go)();const S=(0,K.useQueryClient)(),y=(0,e.useMemo)(()=>({create:A.Z.createRole,read:A.Z.readRoles,update:A.Z.updateRole,delete:A.Z.deleteRole}),[]),{isLoading:P,allowedActions:{canRead:D,canDelete:$}}=(0,l.ss)(y),{isLoading:Ot,data:{roles:ye},isFetching:Ut}=(0,K.useQuery)("get-roles",()=>Le(d,o),{initialData:{},enabled:D}),{includes:Re}=(0,l.L0)(s,{sensitivity:"base"}),Ce=(0,l.Xe)(s,{sensitivity:"base"}),Te=Ot||Ut,xt=()=>{t("willCreateRole"),r(`/settings/${R.Z}/roles/new`)},kt=()=>{i(!m)},It={roles:{id:(0,G.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,G.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Gt=n({id:"global.roles",defaultMessage:"Roles"}),Bt=(0,K.useMutation)(k=>Se(k,d),{async onSuccess(){await S.invalidateQueries("get-roles")}}),Nt=async()=>{E(!0),await Bt.mutateAsync(c),i(!m),E(!1)},Q=(ye||[]).filter(k=>Re(k.name,g)||Re(k.description,g)).sort((k,Ae)=>Ce.compare(k.name,Ae.name)||Ce.compare(k.description,Ae.description)),$t=g&&!Q.length?"search":"roles",jt=4,Ft=(ye?.length||0)+1;return e.createElement(J.A,null,e.createElement(l.SL,{name:Gt}),e.createElement(j.o,{"aria-busy":Te},e.createElement(Z.T,{title:n({id:"global.roles",defaultMessage:"Roles"}),subtitle:n({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(l.jW,{permissions:A.Z.createRole},e.createElement(O.z,{onClick:xt,startIcon:e.createElement(be.Z,null),size:"S"},n({id:(0,G.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(H.Z,{startActions:e.createElement(l.m,{label:n({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(U.D,null,!D&&e.createElement(l.ZF,null),(Te||P)&&e.createElement(l.dO,null),D&&Q&&Q?.length?e.createElement(Y.i,{colCount:jt,rowCount:Ft},e.createElement(F.h,null,e.createElement(I.Tr,null,e.createElement(M.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(M.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.description",defaultMessage:"Description"}))),e.createElement(M.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.users",defaultMessage:"Users"}))),e.createElement(M.Th,null,e.createElement(De.T,null,n({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(xe,{sortedRoles:Q,canDelete:$,permissions:A.Z,setRoleToDelete:C,onDelete:[m,i]})):e.createElement(l.x7,{content:It[$t]})),e.createElement(l.QH,{isConfirmButtonLoading:p,onConfirm:Nt,onToggleDialog:kt,isOpen:m})))},Ie=()=>e.createElement(l.O4,{permissions:A.Z.accessRoles},e.createElement(ke,null)),ne=a(92802),b=a(72850),w=a(15335),x=a(5803),ae=a(10369),re=a(10508),oe=a(66456),Ge=a(29439),B=a(82069),Be=a(33795),W=a.n(Be),Ne=a(86834),$e=a.n(Ne),je=a(86205),Fe=a.n(je);const le=(0,e.createContext)({}),ie=({children:t,value:n})=>e.createElement(le.Provider,{value:n},t),_=()=>(0,e.useContext)(le);ie.propTypes={children:f().node.isRequired,value:f().object.isRequired};var z=a(8471),We=a(37213),Ve=a.n(We),He=a(15738),Ye=a.n(He),we=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}};const ze=(0,z.ZP)(b.x)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function ee({route:t}){const{formatMessage:n}=(0,L.Z)(),{method:s,handler:r,path:d}=t,o=d?Ye()(d.split("/")):[],[u="",g=""]=r?r.split("."):[],m=we(t.method);return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h3"},n({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,u),e.createElement(h.Z,{variant:"delta",textColor:"primary600"},".",g)),e.createElement(v.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(ze,{background:m.background,borderColor:m.border,padding:2},e.createElement(h.Z,{fontWeight:"bold",textColor:m.text},s)),e.createElement(b.x,{paddingLeft:2,paddingRight:2},Ve()(o,i=>e.createElement(h.Z,{key:i,textColor:i.includes(":")?"neutral600":"neutral900"},"/",i)))))}ee.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ee.propTypes={route:f().shape({handler:f().string,method:f().string,path:f().string})};var Xe=ee,Qe=()=>{const{formatMessage:t}=(0,L.Z)(),{selectedAction:n,routes:s}=_(),r=Fe()(n.split("."),"controllers"),d=W()(s,r[0]),o=r.slice(1).join("."),u=$e()(d)?[]:d.filter(g=>g.handler.endsWith(o));return e.createElement(x.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},n?e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},u.map((g,m)=>e.createElement(Xe,{key:m,route:g}))):e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h3"},t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(h.Z,{as:"p",textColor:"neutral600"},t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Je=a(83828),Ke=a(61762),qe=a(89966),_e=a(23940),et=a.n(_e);function tt(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return et()(t.replace("api::","").replace("plugin::",""))}}var st=tt,nt=a(98978),ce=a.n(nt),de=a(8284),at=a(45112);const ue=z.iv`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`;var rt=(0,z.ZP)(b.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&ue}
  &:hover {
    ${ue}
  }
`;const ot=z.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,me=({subCategory:t})=>{const{formatMessage:n}=(0,L.Z)(),{onChange:s,onChangeSelectAll:r,onSelectedAction:d,selectedAction:o,modifiedData:u}=_(),g=(0,e.useMemo)(()=>W()(u,t.name,{}),[u,t]),m=(0,e.useMemo)(()=>Object.values(g).every(c=>c.enabled===!0),[g]),i=(0,e.useMemo)(()=>Object.values(g).some(c=>c.enabled===!0)&&!m,[g,m]),p=(0,e.useCallback)(({target:{name:c}})=>{r({target:{name:c,value:!m}})},[m,r]),E=(0,e.useCallback)(c=>o===c,[o]);return e.createElement(b.x,null,e.createElement(v.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(b.x,{paddingRight:4},e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},t.label)),e.createElement(ot,null),e.createElement(b.x,{paddingLeft:4},e.createElement(de.X,{name:t.name,value:m,onValueChange:c=>p({target:{name:t.name,value:c}}),indeterminate:i},n({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(v.k,{paddingTop:6,paddingBottom:6},e.createElement(w.r,{gap:2,style:{flex:1}},t.actions.map(c=>{const C=`${c.name}.enabled`;return e.createElement(x.P,{col:6,key:c.name},e.createElement(rt,{isActive:E(c.name),padding:2,hasRadius:!0},e.createElement(de.X,{value:W()(u,C,!1),name:C,onValueChange:S=>s({target:{name:C,value:S}})},c.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>d(c.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(at.Z,null))))}))))};me.propTypes={subCategory:f().object.isRequired};var lt=me;const ge=({name:t,permissions:n})=>{const s=(0,e.useMemo)(()=>ce()(Object.values(n.controllers).reduce((r,d,o)=>{const u=`${t}.controllers.${Object.keys(n.controllers)[o]}`,g=ce()(Object.keys(d).reduce((m,i)=>[...m,{...d[i],label:i,name:`${u}.${i}`}],[]),"label");return[...r,{actions:g,label:Object.keys(n.controllers)[o],name:u}]},[]),"label"),[t,n]);return e.createElement(b.x,{padding:6},s.map(r=>e.createElement(lt,{key:r.name,subCategory:r})))};ge.propTypes={name:f().string.isRequired,permissions:f().object.isRequired};var it=ge,ct=(t,n)=>{const s=Object.keys(n).sort().map(r=>({name:r,isOpen:!1}));return{...t,collapses:s}},X=a(97889);const dt={collapses:[]},ut=(t,n)=>(0,X.ZP)(t,s=>{switch(n.type){case"TOGGLE_COLLAPSE":{s.collapses=t.collapses.map((r,d)=>d===n.index?{...r,isOpen:!r.isOpen}:{...r,isOpen:!1});break}default:return s}});var mt=()=>{const{modifiedData:t}=_(),{formatMessage:n}=(0,L.Z)(),[{collapses:s},r]=(0,e.useReducer)(ut,dt,o=>ct(o,t)),d=o=>r({type:"TOGGLE_COLLAPSE",index:o});return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:1},s.map((o,u)=>e.createElement(Je.U,{expanded:o.isOpen,onToggle:()=>d(u),key:o.name,variant:u%2===0?"secondary":void 0},e.createElement(Ke.B,{title:st(o.name),description:n({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:o.name}),variant:u%2?"primary":"secondary"}),e.createElement(qe.v,null,e.createElement(b.x,null,e.createElement(it,{permissions:t[o.name],name:o.name}))))))},gt=a(3040),pe=a.n(gt),pt=a(88708),Et=a.n(pt);const ht={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]};var ft=(t,n)=>(0,X.ZP)(t,s=>{switch(n.type){case"ON_CHANGE":{const r=n.keys.length,d=n.keys[r-1]==="enabled";if(n.value&&d){const o=Et()(n.keys,r-1).join(".");s.selectedAction=o}pe()(s,["modifiedData",...n.keys],n.value);break}case"ON_CHANGE_SELECT_ALL":{const r=["modifiedData",...n.keys],d=W()(t,r,{}),o=Object.keys(d).reduce((u,g)=>(u[g]={...d[g],enabled:n.value},u),{});pe()(s,r,o);break}case"ON_RESET":{s.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{s.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:r}=n;s.selectedAction=r===t.selectedAction?"":r;break}default:return s}}),vt=(t,n,s)=>({...t,initialData:n,modifiedData:n,routes:s});const Ee=(0,e.forwardRef)(({permissions:t,routes:n},s)=>{const{formatMessage:r}=(0,L.Z)(),[d,o]=(0,e.useReducer)(ft,ht,p=>vt(p,t,n));(0,e.useImperativeHandle)(s,()=>({getPermissions(){return{permissions:d.modifiedData}},resetForm(){o({type:"ON_RESET"})},setFormAfterSubmit(){o({type:"ON_SUBMIT_SUCCEEDED"})}}));const i={...d,onChange:({target:{name:p,value:E}})=>o({type:"ON_CHANGE",keys:p.split("."),value:E==="empty__string_value"?"":E}),onChangeSelectAll:({target:{name:p,value:E}})=>o({type:"ON_CHANGE_SELECT_ALL",keys:p.split("."),value:E}),onSelectedAction:p=>o({type:"SELECT_ACTION",actionToSelect:p})};return e.createElement(ie,{value:i},e.createElement(w.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(x.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h2"},r({id:(0,B.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(h.Z,{as:"p",textColor:"neutral600"},r({id:(0,B.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(mt,null))),e.createElement(Qe,null)))});Ee.propTypes={permissions:f().object.isRequired,routes:f().object.isRequired};var he=(0,e.memo)(Ee);const Kt={isLoading:!0,modifiedData:{}},qt=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.modifiedData={};break}case"GET_DATA_SUCCEEDED":{s.isLoading=!1,s.modifiedData=n.data;break}case"GET_DATA_ERROR":{s.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{s.modifiedData=n.data;break}default:return s}});var _t=null;const es=(t,n)=>{const{isLoading:s,allowedActions:r}=useRBAC(n),[{isLoading:d,modifiedData:o},u]=useReducer(reducer,initialState),g=useNotification(),m=useRef(!0),i=new AbortController,{signal:p}=i;useEffect(()=>(s||(async()=>{try{u({type:"GET_DATA"});const C=await request(getRequestURL(t),{method:"GET",signal:p});u({type:"GET_DATA_SUCCEEDED",data:C})}catch(C){m.current&&(u({type:"GET_DATA_ERROR"}),console.error(C),g({type:"warning",message:{id:"notification.error"}}))}})(),()=>{i.abort(),m.current=!1}),[s,t]);const E=useCallback(c=>{u({type:"ON_SUBMIT_SUCCEEDED",data:c})},[]);return{allowedActions:r,dispatchSubmitSucceeded:E,isLoading:d,isLoadingForPermissions:s,modifiedData:o}};var ts=null;const ss={roles:[],isLoading:!0},ns=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.roles=[];break}case"GET_DATA_SUCCEEDED":{s.roles=n.data,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}});var as=null;const rs=(t=!0)=>{const[{roles:n,isLoading:s},r]=useReducer(reducer,initialState,()=>init(initialState,t)),d=useNotification(),o=useRef(!0),u=new AbortController,{signal:g}=u;useEffect(()=>(t&&m(),()=>{u.abort(),o.current=!1}),[t]);const m=async()=>{try{r({type:"GET_DATA"});const{roles:i}=await request(`/${pluginId}/roles`,{method:"GET",signal:g});r({type:"GET_DATA_SUCCEEDED",data:i})}catch(i){const p=get(i,["response","payload","message"],"An error occured");o.current&&(r({type:"GET_DATA_ERROR"}),p!=="Forbidden"&&d({type:"warning",message:p}))}};return{roles:n,isLoading:s,getData:m}};var os=null,yt=(t,n)=>({...t,isLoading:n});const fe={permissions:{},routes:{},isLoading:!0};var Rt=(t,n)=>(0,X.ZP)(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.permissions={},s.routes={};break}case"GET_DATA_SUCCEEDED":{s.permissions=n.permissions,s.routes=n.routes,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}}),ve=(t=!0)=>{const n=(0,l.lm)(),[{permissions:s,routes:r,isLoading:d},o]=(0,e.useReducer)(Rt,fe,()=>yt(fe,t)),u=(0,l.kY)(),g=(0,e.useCallback)(async()=>{try{o({type:"GET_DATA"});const[{permissions:m},{routes:i}]=await Promise.all([`/${R.Z}/permissions`,`/${R.Z}/routes`].map(async p=>(await u.get(p)).data));o({type:"GET_DATA_SUCCEEDED",permissions:(0,G.YX)(m),routes:i})}catch(m){const i=W()(m,["response","payload","message"],"An error occured");o({type:"GET_DATA_ERROR"}),i!=="Forbidden"&&n({type:"warning",message:i})}},[n]);return(0,e.useEffect)(()=>{t&&g()},[g,t]),{permissions:s,routes:r,getData:g,isLoading:d}};const Ct={role:{},isLoading:!0};var Tt=(t,n)=>(0,X.ZP)(t,s=>{switch(n.type){case"GET_DATA_SUCCEEDED":{s.role=n.role,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{s.role.name=n.name,s.role.description=n.description;break}default:return s}}),At=t=>{const[n,s]=(0,e.useReducer)(Tt,Ct),r=(0,l.lm)(),d=(0,e.useRef)(null),{get:o}=(0,l.kY)();(0,e.useEffect)(()=>(d.current=!0,t?u(t):s({type:"GET_DATA_SUCCEEDED",role:{}}),()=>d.current=!1),[t]);const u=async m=>{try{const{data:{role:i}}=await o(`/${R.Z}/roles/${m}`);d.current&&s({type:"GET_DATA_SUCCEEDED",role:i})}catch(i){console.error(i),s({type:"GET_DATA_ERROR"}),r({type:"warning",message:{id:"notification.error"}})}},g=(0,e.useCallback)(m=>{s({type:"ON_SUBMIT_SUCCEEDED",...m})},[]);return{...n,onSubmitSucceeded:g}},N=a(24346),Pt=N.Ry().shape({name:N.Z_().required(l.I0.required),description:N.Z_().required(l.I0.required)}),Dt=()=>{const{formatMessage:t}=(0,L.Z)(),[n,s]=(0,e.useState)(!1),r=(0,l.lm)(),{lockApp:d,unlockApp:o}=(0,l.o1)(),{params:{id:u}}=(0,T.$B)(`/settings/${R.Z}/roles/:id`),{isLoading:g,routes:m}=ve(),{role:i,onSubmitSucceeded:p,isLoading:E}=At(u),c=(0,e.useRef)(),{put:C}=(0,l.kY)(),S=async y=>{d(),s(!0);try{const P=c.current.getPermissions();await C(`/${R.Z}/roles/${u}`,{...y,...P,users:[]}),p({name:y.name,description:y.description}),r({type:"success",message:{id:(0,B.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(P){console.error(P),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),o()};return E?e.createElement(l.dO,null):e.createElement(j.o,null,e.createElement(l.SL,{name:"Roles"}),e.createElement(ne.J9,{enableReinitialize:!0,initialValues:{name:i.name,description:i.description},onSubmit:S,validationSchema:Pt},({handleSubmit:y,values:P,handleChange:D,errors:$})=>e.createElement(l.l0,{noValidate:!0,onSubmit:y},e.createElement(Z.T,{primaryAction:!g&&e.createElement(O.z,{disabled:i.code==="strapi-super-admin",type:"submit",loading:n,startIcon:e.createElement(oe.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:i.name,subtitle:i.description,navigationAction:e.createElement(l.rU,{startIcon:e.createElement(Ge.Z,null),to:"/settings/users-permissions/roles"},t({id:"global.back",defaultMessage:"Back"}))}),e.createElement(U.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(b.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(h.Z,{variant:"delta",as:"h2"},t({id:(0,B.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(w.r,{gap:4},e.createElement(x.P,{col:6},e.createElement(ae.o,{name:"name",value:P.name||"",onChange:D,label:t({id:"global.name",defaultMessage:"Name"}),error:$.name?t({id:$.name,defaultMessage:"Invalid value"}):null})),e.createElement(x.P,{col:6},e.createElement(re.g,{name:"description",value:P.description||"",onChange:D,label:t({id:"global.description",defaultMessage:"Description"}),error:$.description?t({id:$.description,defaultMessage:"Invalid value"}):null}))))),!g&&e.createElement(he,{ref:c,permissions:i.permissions,routes:m}))))))},bt=()=>e.createElement(l.O4,{permissions:A.Z.updateRole},e.createElement(Dt,null)),Lt=N.Ry().shape({name:N.Z_().required(l.I0.required),description:N.Z_().required(l.I0.required)}),St=()=>{const{formatMessage:t}=(0,L.Z)(),[n,s]=(0,e.useState)(!1),r=(0,l.lm)(),{goBack:d}=(0,T.k6)(),{lockApp:o,unlockApp:u}=(0,l.o1)(),{isLoading:g,permissions:m,routes:i}=ve(),{trackUsage:p}=(0,l.rS)(),E=(0,e.useRef)(),{post:c}=(0,l.kY)(),C=async S=>{o(),s(!0);try{const y=E.current.getPermissions();await c(`/${R.Z}/roles`,{...S,...y,users:[]}),p("didCreateRole"),r({type:"success",message:{id:(0,B.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),d()}catch(y){console.error(y),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),u()};return e.createElement(j.o,null,e.createElement(l.SL,{name:"Roles"}),e.createElement(ne.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:C,validationSchema:Lt},({handleSubmit:S,values:y,handleChange:P,errors:D})=>e.createElement(l.l0,{noValidate:!0,onSubmit:S},e.createElement(Z.T,{primaryAction:!g&&e.createElement(O.z,{type:"submit",loading:n,startIcon:e.createElement(oe.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(U.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(b.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(h.Z,{variant:"delta",as:"h2"},t({id:(0,B.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(w.r,{gap:4},e.createElement(x.P,{col:6},e.createElement(ae.o,{name:"name",value:y.name||"",onChange:P,label:t({id:"global.name",defaultMessage:"Name"}),error:D.name?t({id:D.name,defaultMessage:"Invalid value"}):null})),e.createElement(x.P,{col:6},e.createElement(re.g,{name:"description",value:y.description||"",onChange:P,label:t({id:"global.description",defaultMessage:"Description"}),error:D.description?t({id:D.description,defaultMessage:"Invalid value"}):null}))))),!g&&e.createElement(he,{ref:E,permissions:m,routes:i}))))))},Zt=()=>e.createElement(l.O4,{permissions:A.Z.createRole},e.createElement(St,null)),Mt=()=>e.createElement(l.O4,{permissions:A.Z.accessRoles},e.createElement(T.rs,null,e.createElement(T.AW,{path:`/settings/${R.Z}/roles/new`,component:Zt,exact:!0}),e.createElement(T.AW,{path:`/settings/${R.Z}/roles/:id`,component:bt,exact:!0}),e.createElement(T.AW,{path:`/settings/${R.Z}/roles`,component:Ie,exact:!0}),e.createElement(T.AW,{path:"",component:l.Hn})))},59677:function(Pe,V,a){a.d(V,{YX:function(){return R},Gc:function(){return J},OB:function(){return j.Z}});var e=a(86834),T=a.n(e),R=Z=>Object.keys(Z).reduce((O,H)=>{const U=Z[H].controllers,Y=Object.keys(U).reduce((F,I)=>(T()(U[I])||(F[I]=U[I]),F),{});return T()(Y)||(O[H]={controllers:Y}),O},{}),A=a(90201),J=Z=>`/${A.Z}/${Z}`,j=a(82069)}}]);
